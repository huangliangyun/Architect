#### 问题

+ ZK 的读取机制？
+ ZK 如何实现数据同步？
+ ZK 选举原理？
+ ZK 节点为什么一定要奇数？
+ ZK 和Eureka的区别？




#### 答案

+ ZK 的读取机制？  
1、ZK 集群只有一个 Leader 和多个 Follower  
2、每个 Follower 节点保存Leader节点的副本
3、全局数据一定要保持一致性  
4、写的请求统一交给 Leader 完成，Follower 节点主要实现读操作


+ ZK 如何实现数据同步？  
1、所有 Followe r的写请求统一交给一个 Leader 实现，Leader 同步数据的时候创建一个全局事务 ID 为 zxid。  
2、Leader 节点在第一阶段通知阶段，会带上 zxid 向每位 Follower 发出确认同步通知。  
3、只要有过半数的 Follower 节点确认同步 ack，Leader 就会向所有 Follower 发出 commit 事务数据提交。  
类似于两段式提交2pc解决数据同步问题

+ ZK 选举原理？  
1、服务器启动的时候，每个 Server 都是选举状态，或者如果当前 Leader 宕机后，非 Observer 角色的节点都会重新进入选举状态。  
2、发起投票的时候，每个 Server 都会产生 [myid,zxid] 投票选举，系统默认 zxid 为0，zxid 的值取决于最后一次更新操作，zxid 越大，数据越新。  
3、Server 进行投票 PK，投票首先会投给自己，如果自己的 myid 比别的小，就会投给别的 Server  
1)先检查 zxid，谁大谁就是 Leader  
2)如果 zxid 都是一样的情况下，myid 越大的就是 Leader  
3)如果过半机制已经选举出了 Leader，之后的节点不会加入选举


+ ZK 节点为什么一定要奇数？  
1、保证 ZK 可以使用，必须遵循过半原则，可用节点>集群总节点/2,节约资源  
如果有 5 个节点，最多只能宕机 2 台，否则无法使用， 3>5/2  
如果有 6 个节点，最多当街 2 台，否则无法使用， 4>6/2 3!>6/3


+ ZK 和 Eureka 的区别？  
相同点：  
1、都可以实现注册中心  
不同点：  
1、ZK 是 CP，如果 ZK 在某种情况下出现宕机，会重新选举领导者，如果选举时间过长，或者投票数没有过半，会导致 ZK 集群不可用，也就是注册中心不可用，因为 ZK 必须保证数据一致性问题。  
2、Eureka 是 AP，设计时优先考虑可用性，你中有我，我中有你，去中心化思想，每个节点都均等，没有主从区别，几个节点挂掉也不会影响 Eureka 的使用，只要有一个节点存在就可以保证Eureka 整个服务注册中心的使用。
所以 ZK 保证数据一致性问题，Eureka 保证可用性问题  

   