#### 问题
+ 请谈一谈，网站在架构上应当考虑哪些问题？
+ REST 与 RPC 区别？
+ 分布式事务的实现方法？
+ 微服务有什么优缺点？
+ 熔断概念？熔断原理？熔断三个状态关系？
+ 什么是 RPC？怎么实现幂等性？
+ 配置中心有哪些选项？Apollo 的架构？怎么无感实现已加载数据更新？



#### 答案
+ 请谈一谈，网站在架构上应当考虑哪些问题？  
1）分层  
比较常见的分层模式是MVC，将软件分为持久层，业务层，视图层  
2）分割  
分割是对软件的纵向切分。我们可以将系统的不同功能和服务分割开，形成高内聚低耦合的功能模块。
3）分布式  
除了上面的内容，网站的静态资源也可以采用分布式，减轻服务器的负载压力，使得浏览器对资源的加载更快，
数据的读取应该也是分布式，比如说主从复制，读写分离。网站后台业务还有一些中间件也应该使用分布式。  
4）集群  
集群使得有更多的服务器提供相同的服务，使得系统有更高的并发支持  
5）缓存  
使用空间换时间，把热点数据进行缓存，减少系统的响应时间，提高用户体验  
6）异步  
异步是解耦的一种手段，也是生产者消费者模式，比如引入一些消息队列，进行削峰  
7）容灾  
提供相应的容灾服务器，保证某些服务器宕机后，网站还能正常响应  


+ REST 与 RPC 区别？  
REST 是一种风格，把网络上所有内容视为资源，POST，GET，PUT，DELETE对应CREATE，Read，Update，Delete  
RPC是远程过程调用，就像调用本地方法一样调用远程方法。  
原理：
1）客户端和服务端分别维护一个[ID->函数对应表]，ID在所有进程都是唯一确定，客户端在做远程调用的时候，附上ID，服务端通过查表，执行相应函数。  
2）客户端和服务端在交互时将参数和结果转化为字节流在网络中传输  
3）gRPC使用HTTP协议，Dubbo自定义了Dubbo协议。  


+ 分布式事务的实现方法？  
2pc，3pc，tcc，MQ  


+ 微服务有什么优缺点？  
优点：  
1、独立部署，耦合性低  
2、适合敏捷开发  
3、职责专一，专门团队负责专门服务  
4、代码复用，使用 REST 远程调用  
缺点：
1、分布式部署复杂性高  
2、测试难度提升，变得复杂  
3、独立数据库，分布式事务的挑战  
4、问题排查难度提升，运维难度提升  


+ 熔断概念？熔断原理？熔断三个状态关系？  
一个服务错误过多，短时间不可用，就开启熔断，防止没有意义的调用，服务方定时重试，如果可用，就使用。
闭合状态：添加计数器，失败次数指定时间超过一定阈值，开启熔断。开启一个计时，过了一段时间，半开状态，服务尝试调用。  
断开状态：服务立马返回错误信息，减少资源消耗。  
半开状态：允许一定数量的请求，如果成功，关闭熔断，如果还是发生错误，切换到断开。  


+ 什么是 RPC？怎么实现幂等性？  
RPC（Remote Procedure Call）远程过程调用，简单的理解是一个节点请求另一个节点提供的服务。
幂等性：用户对同一操作发起一次或多次请求，结果都是一致的，不会因为多次点击产生了副作用。  
保证：  
1、每个请求，必须有唯一标识，比如订单id，一个订单只能支付一次  
2、每次请求后，必须有一个记录标识这个请求处理过了  
3、可以使用 Redis 存储 orderId 作为唯一键，成功插入这个orderId才能进行付款   


+ 配置中心有哪些选项？Apollo 的架构？怎么无感实现已加载数据更新？  
选项：nacos，zookeeper，apollo，config  
Apollo架构：  
1、四个核心模块  
ConfigService：提供配置获取接口，提供配置推送接口，服务于apollo客户端  
AdminService：提供配置管理接口，提供配置修改发布接口，提供管理界面Portal  
Client：为应用获取配置实时更新   
Portal：配置管理界面  
2、三个辅助服务发现模块  
Eureka：服务注册与发现，注册实例实时发送心跳
MetaServer：  
Portal通过域名访问MetaServer获取AdminService地址  
Client通过域名访问MetaServer获取ConfigService地址  
逻辑角色，和ConfigService一起部署   
NginxLB：和域名系统配置，主要是获取地址  
https://mp.weixin.qq.com/s/-hUaQPzfsl9Lm3IqQW3VDQ

  